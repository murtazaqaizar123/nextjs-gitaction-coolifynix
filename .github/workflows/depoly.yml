name: Manual Deploy to Coolify

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Which branch to deploy?'
        required: true
        default: 'main'
        type: choice
        options:
          - main
          - main2

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger Coolify Deployment
        run: |
          echo "Deploying branch: ${{ github.event.inputs.branch }}"

          response=$(curl -s -w "%{http_code}" -o coolify_response.json \
            -X POST https://www.q-solutions.pk/api/v1/deploy \
            -H "Authorization: Bearer ${{ secrets.COOLIFY_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d "{
              \"uuid\": \"jgwswck8cwkock48c8w80k0c\",
              \"branch\": \"${{ github.event.inputs.branch }}\"
            }")

          echo "Coolify API response code: $response"
          echo "Coolify API response body:"
          cat coolify_response.json

          if [ \"$response\" -ne 200 ]; then
            echo "‚ùå Deployment trigger failed with status $response"
            exit 1
          fi
